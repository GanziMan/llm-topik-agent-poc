# TOPIK 쓰기 자동 채점 시스템 (Multi-Agent Architecture)

Google ADK(Agent Development Kit) 환경에 특화된 TOPIK(한국어능력시험) 쓰기 자동 채점 시스템입니다.

## 📋 시스템 개요

TOPIK 51-54번 쓰기 문항을 문항 유형별로 전문화된 에이전트가 채점하는 멀티-에이전트 아키텍처입니다.

### 지원 문항

- **51-52번**: 담화 완성 (빈칸 ㉠, ㉡ 채우기) - 각 10점
- **53번**: 설명문 작성 (200~300자) - 30점
- **54번**: 논술문 작성 (600~700자) - 50점

## 🏗️ 아키텍처 구조

```
topik_writer_grader/
├── prompts.py          # 모든 프롬프트 중앙 관리
├── agent.py           # 오케스트레이터 에이전트 (메인)
├── utils.py           # 유틸리티 함수들
└── sub_agents/        # 전문 채점 에이전트들
    ├── grader_51_52/  # 51-52번 담화 완성 전담
    ├── grader_53/     # 53번 설명문 전담
    └── grader_54/     # 54번 논술문 전담
```

## 🚀 사용 방법

### 기본 사용법

```python
from topik_writer_grader.agent import OrchestratorAgent

# 오케스트레이터 에이전트 초기화
orchestrator = OrchestratorAgent()

# 채점 수행
result = orchestrator.grade(
    question_number=53,
    question_prompt="다음 자료를 보고 '휴대폰의 기능 변화'에 대한 글을 200~300자로 쓰십시오.",
    answer_text="최근 휴대폰은 과거와 달리 많은 기능 변화를 보였다..."
)

print(result)
```

### 터미널에서 테스트

```bash
cd api/poc-agent
python -m topik_writer_grader.agent
```

## 📊 채점 결과 구조

```json
{
  "점수": {
    "㉠_빈칸": 5, // 51-52번만
    "㉡_빈칸": 5, // 51-52번만
    "내용_과제수행": 7, // 53-54번만
    "전개_구조": 7, // 53-54번만
    "언어_사용": 16 // 53-54번만
  },
  "총점": 10,
  "강점": ["구체적 강점 사항들"],
  "약점": ["개선 필요 사항들"],
  "개선_방안": ["구체적 개선 방법들"],
  "총평": "종합적인 평가",
  "글자수": 245, // 53-54번만
  "글자수_평가": "적정 범위 내 (200~300자)" // 53-54번만
}
```

## ⚙️ 주요 기능

### 1. 멀티-에이전트 아키텍처

- 문항 유형별 전문화된 채점 에이전트
- 오케스트레이터 패턴으로 적절한 에이전트 라우팅
- 각 에이전트별 독립적인 프롬프트 관리

### 2. 정교한 채점 기준

- TOPIK 공식 채점 기준 완전 반영
- 문항별 세분화된 루브릭 적용
- 예시 응답을 통한 채점 일관성 확보

### 3. 입력 검증 및 에러 처리

- 문항 번호, 질문, 답안 유효성 검증
- 점수 범위 자동 검증
- 상세한 에러 메시지 제공

### 4. 유틸리티 기능

- 정확한 한국어 글자수 계산
- 문항별 글자수 범위 평가
- 결과 포맷팅 기능

## 📁 파일별 상세

### `prompts.py`

- 역할, 시스템, 컨텍스트 프롬프트 중앙 관리
- 문항별 채점 기준 및 예시 응답 포함
- 프롬프트 템플릿 제공

### `agent.py` (오케스트레이터)

- 메인 채점 로직 및 라우팅
- 입력 검증 및 에러 처리
- 결과 후처리 및 검증

### `utils.py`

- 글자수 계산 및 평가
- 점수 유효성 검증
- 프롬프트 조합 기능
- 결과 포맷팅

### `sub_agents/*/agent.py`

- 각 문항 유형별 전문 채점 로직
- 해당 문항의 프롬프트 조합
- 플레이스홀더 응답 (실제 LLM 연동 대기)

## 🔧 Google ADK 연동 준비사항

현재는 플레이스홀더 응답을 반환하도록 구현되어 있습니다.
실제 Google ADK 연동을 위해서는 각 하위 에이전트의 `run` 메소드에서:

1. `utils.combine_prompts()`를 사용하여 최종 프롬프트 생성
2. Google ADK를 통해 LLM 호출
3. 응답 파싱 및 JSON 구조화
4. `utils.validate_score_range()`로 점수 검증
